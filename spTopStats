USE [NBADB]
GO
/****** Object:  StoredProcedure [dbo].[spTopStats]    Script Date: 4/21/2017 2:29:52 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[spTopStats]
@ORDER VARCHAR(3)
AS
BEGIN

IF (@ORDER = '1')
BEGIN

	SET NOCOUNT ON
	SELECT TOP 10 CONVERT(VARCHAR(20),p.plFirstName + ' ' + ISNULL(p.plLastName,'')) as Name,CONVERT(VARCHAR(17),t.tmLocation) as Location
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints])))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists])))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds])))) as AvgRebounds
		  ,COUNT([gs_gmID]) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY p.plFirstName,p.plLastName,t.tmLocation
	ORDER BY CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints]))) DESC, GamesPlayed DESC,CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists]))) DESC, CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds]))) DESC

	SELECT TOP 10 CONVERT(VARCHAR(20),p.plFirstName + ' ' + ISNULL(p.plLastName,'')) as Name,CONVERT(VARCHAR(17),t.tmLocation) as Location
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints])))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists])))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds])))) as AvgRebounds
		  ,COUNT([gs_gmID]) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY p.plFirstName,p.plLastName,t.tmLocation
	ORDER BY CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists]))) DESC, GamesPlayed DESC, CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints]))) DESC, CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds]))) DESC

	SELECT TOP 10 CONVERT(VARCHAR(20),p.plFirstName + ' ' + ISNULL(p.plLastName,'')) as Name,CONVERT(VARCHAR(17),t.tmLocation) as Location
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints])))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists])))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds])))) as AvgRebounds
		  ,COUNT([gs_gmID]) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY p.plFirstName,p.plLastName,t.tmLocation
	ORDER BY CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds]))) DESC, GamesPlayed DESC, CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints]))) DESC, CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists]))) DESC


	SELECT CONVERT(VARCHAR(30),t.tmLocation + ' ' + t.tmName) as [Team Name]
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsPoints])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsAssists])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsRebounds])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgRebounds
		  ,(t.tmTotalWins+t.tmTotalLosses) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY t.tmLocation,t.tmName,t.tmTotalWins,t.tmTotalLosses
	ORDER BY AvgPoints DESC, GamesPlayed DESC, AvgAssists DESC, AvgRebounds DESC

END

ELSE IF (@ORDER = '2')
BEGIN

	SELECT CONVERT(VARCHAR(30),t.tmLocation + ' ' + t.tmName) as [Team Name]
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsPoints])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsAssists])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsRebounds])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgRebounds
		  ,(t.tmTotalWins+t.tmTotalLosses) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY t.tmLocation,t.tmName,t.tmTotalWins,t.tmTotalLosses
	ORDER BY AvgAssists DESC, GamesPlayed DESC, AvgPoints DESC, AvgRebounds DESC

END

ELSE IF (@ORDER = '3')
BEGIN

	SELECT CONVERT(VARCHAR(30),t.tmLocation + ' ' + t.tmName) as [Team Name]
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsPoints])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsAssists])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(4,1),(SUM(CONVERT(DECIMAL(4,1),[gsRebounds])) / (CONVERT(DECIMAL(4,1),t.tmTotalWins)+CONVERT(DECIMAL(4,1),t.tmTotalLosses))))) as AvgRebounds
		  ,(t.tmTotalWins+t.tmTotalLosses) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	GROUP BY t.tmLocation,t.tmName,t.tmTotalWins,t.tmTotalLosses
	ORDER BY AvgRebounds DESC, GamesPlayed DESC, AvgPoints DESC, AvgAssists DESC

END

ELSE IF (LEN(@ORDER) > 1)
BEGIN

	SET @ORDER = CONVERT(INT,@ORDER)

	SELECT p.plID,CONVERT(VARCHAR(20),p.plFirstName + ' ' + ISNULL(p.plLastName,'')) as Name,CONVERT(VARCHAR(17),t.tmLocation) as Location
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsPoints])))) as AvgPoints
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsAssists])))) as AvgAssists
		  ,CONVERT(VARCHAR(15),CONVERT(DECIMAL(3,1),AVG(CONVERT(DECIMAL(3,1),[gsRebounds])))) as AvgRebounds
		  ,COUNT([gs_gmID]) as GamesPlayed
	  FROM [NBADB].[dbo].[tblGameStats] gs
	  JOIN tblPlayer p
		ON p.plID = gs.gs_plID
	  JOIN tblTeam t
		ON t.tmID = p.plTeam
	WHERE p.plID = @ORDER
	GROUP BY p.plID,p.plFirstName,p.plLastName,t.tmLocation

END

END
